@(searchResult:List[dao.ProjectResponse],request: play.mvc.Http.Request, keyWord: String, response: HashMap[String, List[dao.ProjectResponse]])
@main("Freelancelot"){
<html lang="en" class="no-js">
    <head>
       	<meta charset="utf-8">
  		<meta name="viewport" content="width=device-width, initial-scale=1">
  		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <script src="public/javascripts/main.js"></script>
        <link rel="stylesheet" href="public/stylesheets/main.css">
        
        <!--[if IE]>
  		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
    </head>
	<script>
        init()
                var webSocket;
                function init() {
                    initWebSocket();

            }
            async function initWebSocket() {
                @for( (keyword, searchResult:List[dao.ProjectResponse]) <- response ){
                @if(request.session().get(keyword).isPresent() || keyword==keyWord){
                    webSocket = new WebSocket("@routes.HomeController.socket(keyWord:String).webSocketURL(request)");
                    console.log("WebSocket -> ",webSocket)
                    webSocket.onopen = onOpen;
                    webSocket.onclose = onClose;
                    webSocket.onmessage = onMessage;
                    webSocket.onerror = onError;
                }
			}
            }

			async function onOpen(evt) {
                writeToScreen("CONNECTED");
            }

            async function onClose(evt) {
                writeToScreen("DISCONNECTED");
            }

            async function onError(evt) {
                writeToScreen("ERROR: " + JSON.stringify(evt));
            }
            
            async function onMessage(evt) {
            	var webSocketData = JSON.parse(evt.data);
            	console.log("Data from Web Socket call â†“");
				console.log(webSocketData);
                
                let headline = "";
                let tableContent = "";
                
                headline += "Search Term: " + "@keyWord" + "  |  Flesch Index: " + "@{searchResult.map(_.flesch_index).sum/searchResult.size()}" + "  |  FKGL: " + "@{searchResult.map(_.fkgl).sum/searchResult.size()}";
                document.getElementById("search_term").innerHTML = headline;
                
                tableContent += "<thead><tr><th>Sr.No</th><th>Owner ID</th><th>Time Submitted</th><th>Project Title</th><th>Project Type</th><th>Project Skills</th><th>Project Stats</th><th>Flesch Index</th><th>FKG Index</th><th>Edu. Level</th></tr></thead>";
                
                if (webSocketData.length!=0) {
                	for (let i = 0; i < webSocketData.length; i++) {
                		let asyncData = webSocketData[i];
                		tableContent +=
                		"<tr><td>" + (i+1) + "</td>" +
			    		"<td>" + asyncData.owner_id + "</td>" +
			    		"<td>" + asyncData.time_submitted + "</td>" +
			    		"<td><a href=\"https://www.freelancer.com/projects/" + asyncData.seo_url + "?w=f&ngsw-bypass=\" target=\"_blank\">" + asyncData.title + "</a></td>" +
			    		"<td>" + asyncData.project_type + "</td><td>";
			    		
			    		if (asyncData.skills.length > 0) {
                            if (asyncData.skills.length == 1) {
                            	tableContent += "<a href=\"/Skills?skill="+ asyncData.skills[0]+ "\" target=\"_blank\">" + asyncData.skills[0] + "</a>";
                            } else {
                            	for (let j = 0; j < asyncData.skills.length; j++) {
                                   	let skill = asyncData.skills[j];
                                   	tableContent += "<a href=\"/Skills?skill=" + skill + "\" target=\"_blank\">" + skill + ", " + "</a>";                            
    			    			}	
                            }
			    		}
			    		
			    		tableContent += "</td><td><a href=\"/Stats/" + asyncData.prevDescriptor+ "\" target=\"_blank\">" + "Stats" + "</a></td>" +
			    		"<td>" + asyncData.flesch_index + "</td>" + 
			    		"<td>" + asyncData.fkgl + "</td>" +
			    		"<td>" + asyncData.edu_level + "</td></tr>";
                	}
                }
                
                document.getElementById("infoTable").innerHTML = tableContent;
            }
   
    </script>
    <body class="FreeLance-soen">
    
    <div class="container">
   	<center><h3>Welcome to FreeLanceLot</h3>      
        <main class="main-wrap-open">
            <div class="center">
                <form class="form-inline" method="GET" action="/SearchPage" onsubmit="myFunction()">
                    @if(request.session().data().size() < 9) {
                    	<input class="form-control" id="s_val" name="keyWord" type="text" placeholder="Enter Search Terms"/>
                    	<input type="submit" id="btn_submit" class="btn btn-success" value="Search" />
                    } else {
                    	<input class="form-control" id="s_val" name="keyWord" type="text" placeholder="Enter Search Terms" disabled/>
                    	<input type="submit" id="btn_submit" class="btn btn-success" value="Search" disabled/>
                    }
                     
                </form>
                <br>
                <div class="main-body">
           
                </div>
            </div>
        </main></center>
        <div class="search-body">
        @if(searchResult.isEmpty() && searchResult.size()==0) {
        	<div class="search">
        	<table id="infoTable" class="table">
	        	<tr><h3><i>No Result to Show Please Search in box</i></h3></tr>
	        </table>
	        </div>
        } else {
        	<center><h5><a href="/GlobalStats" target="_blank">Global Stats</a></h5></center>
        	<h5 class="pheadline" id="search_term">Search Term: @keyWord  |  Flesch Index: @{searchResult.map(_.flesch_index).sum/searchResult.size()}  |  FKGL: @{searchResult.map(_.fkgl).sum/searchResult.size()}</h5>	
        	<div class="search">
        	<table id="infoTable" class="table">
			@if(searchResult!=null && searchResult.size()!=0){
					<thead>
      					<tr>
      					<th>Sr.No</th>
        				<th>Owner ID</th>
        				<th>Time Submitted</th>
        				<th>Project Title</th>
        				<th>Project Type</th>
        				<th>Project Skills</th>
        				<th>Project Stats</th>
        				<th>Flesch Index</th>
        				<th>FKG Index</th>
        				<th>Edu. Level</th>
      					</tr>
    				</thead>
    				@for((project, index)<-searchResult.zipWithIndex){
					<tr>
						<td>@(index+1)</td>
			    		<td><a href="@routes.HomeController.profile(project.owner_id)"  target="_blank">@project.owner_id</a> </td>
		    			<td>@project.time_submitted</td>
		    			<td><a href="https://www.freelancer.com/projects/@project.seo_url?w=f&ngsw-bypass=" target="_blank">@project.title</a></td>
		    			<td>@project.project_type</td>
			   			<td>@for((skill, index)<-project.skills.zipWithIndex){
			   				@if(project.skills.size() == (index + 1)) {
			   					<a href="/Skills?skill=@skill" target="_blank">@skill</a>
			   				} else {
			    				<a href="/Skills?skill=@skill" target="_blank">@skill</a>,
			    			}
			    		}</td>
			   			<td><a href="/Stats/@project.prevDescriptor" target="_blank">Stats</a></td>
			    		<td>@project.flesch_index</td>
			    		<td>@project.fkgl</td>
			    		<td>@project.edu_level</td>
			    	</tr>
					}
				} else{
					<tr><h3><i>No Result to Show Please Search in box</i></h3></tr>
				}
			</table>
		</div>
        	@for((keyword, results) <- response){
        	@if(keyword !=keyWord){ 
        	@if(request.session().get(keyword).isPresent()){
        	<br><h5 class="pheadline" id="search_term">Search Term: @keyword  |  Flesch Index: @{results.map(_.flesch_index).sum/results.size()}  |  FKGL: @{results.map(_.fkgl).sum/results.size()}</h5>	
        	
        	<div class="search">
        	<table id="infoTable" class="table">
			@if(results!=null && results.size()!=0){
					<thead>
      					<tr>
      					<th>Sr.No</th>
        				<th>Owner ID</th>
        				<th>Time Submitted</th>
        				<th>Project Title</th>
        				<th>Project Type</th>
        				<th>Project Skills</th>
        				<th>Project Stats</th>
        				<th>Flesch Index</th>
        				<th>FKG Index</th>
        				<th>Edu. Level</th>
      					</tr>
    				</thead>				
					@for((project, index)<-results.zipWithIndex){
					<tr>
						<td>@(index+1)</td>
			    		<td><a href="@routes.HomeController.profile(project.owner_id)"  target="_blank">@project.owner_id</a> </td>
			    		<td>@project.time_submitted</td>
			    		<td><a href="https://www.freelancer.com/projects/@project.seo_url?w=f&ngsw-bypass=" target="_blank">@project.title</a></td>
			   			<td>@project.project_type</td>
			   			<td>@for((skill, index)<-project.skills.zipWithIndex){
			   				@if(project.skills.size() == (index + 1)) {
			    				<a href="/Skills?skill=@skill" target="_blank">@skill</a>
			    			} else {
			    				<a href="/Skills?skill=@skill" target="_blank">@skill</a>,
			    			}
			    		}</td>
			   			<td><a href="/Stats/@project.prevDescriptor" target="_blank">Stats</a></td>
			   			<td>@project.flesch_index</td>
			   			<td>@project.fkgl</td>
			    		<td>@project.edu_level</td>
			    	</tr>
					}
				} else{
					<tr><h3><i>No Result to Show Please Search in box</i></h3></tr>
				}
			</table>
		</div>
			}
        	}
        	}
        	 }
        </div>
	</div>
        
		<br><br><br>
        <script src="@routes.Assets.versioned("javascripts/search.js")"></script>
    </body>
</html>
}